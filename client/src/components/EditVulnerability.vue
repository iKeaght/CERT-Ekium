<template>
  <div>
    <panel title="Vulnerability Metadata">
      <v-text-field
        label="Title"
        type="text"
        autocomplete="off"
        required
        :rules="[required]"
        v-model="vulnerability.title"
      ></v-text-field>
      <div class="error2" v-html="error" v-if="error">{{error}}</div>
      <br>
      <v-btn dark class="cyan" router to="/vulnerabilities">Cancel</v-btn>
      <v-btn dark class="cyan" @click="saveVulnerability">Save Vulnerability</v-btn>
      
    </panel>
  </div>
</template>

<script>
import Panel from "@/components/Panel";
import VulnerabilitiesService from "@/services/VulnerabilitiesService";
export default {
  data() {
    return {
      vulnerability: {
        title: null,
      },
      error: null,
      required: (value) => !!value || "Required",
    };
  },
  components: {
    Panel,
  },
  methods: {
    async saveVulnerability() {
        this.error = null
      const areAllFieldsFilledIn = Object.keys(this.vulnerability).every(
        (key) => !!this.vulnerability[key]
      );
      if (!areAllFieldsFilledIn) {
        this.error = "Please fill in the required field";
        return;
      }
      const vulnerabilityId = this.$store.state.route.params.vulnerabilityId
      try{
      await VulnerabilitiesService.put(this.vulnerability)
      this.$router.push({
        name:'vulnerabilities', params:{vulnerabilityId: vulnerabilityId}
      })
      }catch(err){
        console.log(err)

      }
    }
    
  },
  async mounted(){
    try {
        const vulnerabilityId = this.$store.state.route.params.vulnerabilityId
        this.vulnerability = (await VulnerabilitiesService.show(vulnerabilityId)).data
      } catch (err) {
        console.log(err);
      }
  }

};
</script>

<style>
</style>