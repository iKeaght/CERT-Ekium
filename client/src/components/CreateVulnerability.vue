<template>
  <div>
    <panel title="Vulnerability Metadata">
      <v-text-field
        v-on:keyup.enter="createVulnerability()"
        label="Title"
        type="text"
        autocomplete="off"
        required
        :rules="[required]"
        v-model="vulnerability.title"
      ></v-text-field>
      <div class="error2" v-html="error" v-if="error">{{error}}</div>
      <br>
      <v-btn dark class="grey darken-1" router to="/vulnerabilities">Cancel</v-btn>
      <v-btn dark class="grey darken-1" @click="createVulnerability">Add Vulnerability</v-btn>

    </panel>
  </div>
</template>

<script>
import Panel from '@/components/Panel'
import VulnerabilitiesService from '@/services/VulnerabilitiesService'
export default {
  data() {
    return {
      vulnerability: {
        title: null
      },
      error: null,
      required: (value) => !!value || 'Required'
    }
  },
  components: {
    Panel
  },
  methods: {
    async createVulnerability() {
        this.error = null
      const areAllFieldsFilledIn = Object.keys(this.vulnerability).every(
        (key) => !!this.vulnerability[key]
      )
      if (!areAllFieldsFilledIn) {
        this.error = 'Please fill in the required field'
        return
      }
      try {
        await VulnerabilitiesService.post(this.vulnerability)
        this.$router.push({
          name: 'vulnerabilities'
        })
      } catch (err) {
        console.log(err)
      }
    }
  }
}
</script>

<style>
</style>
